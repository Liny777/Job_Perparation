从输入 URL 到页面展示到底发生了什么?
1、输入地址
2、浏览器查找域名的IP地址
3、浏览器向web服务器发送一个HTTP请求
4、服务器的永久重定向响应  ？
5、服务器处理请求
6、服务器返回一个HTTP响应
7、浏览器显示HTML
8、浏览器发送请求获取嵌入在HTML中的资源（如图片，音频，视频，CSS、JS等）

1、输入地址
当我们开始在浏览器中输入网址的时候，浏览器其实就已经在智能的匹配可能得到的url了，他会从历史记录，书签等地方，找到已经输入的字符串可能对应的url，然后给出智能提示，让你可以补全url地址。对于google的chrome的浏览器，他甚至会直接从缓存中把网页展示出来，就是说，你还没有按下enter，页面就出来了。

2、浏览器查找域名的IP地址
1、请求一旦发起，浏览器首先要做的事情就是解析这个域名，一般来说，浏览器会首先查看本地硬盘的hosts文件，看看其中有没有和这个域名对应的规则，如果有的话就直接使用hosts文件里面的ip地址。

2、如果在本地的hosts文件没有能够找到对应的ip地址，浏览器会发出一个DNS请求到本地DNS服务器。本地DNS服务器一般都是你的网络接入服务器商提供，比如中国电信，中国移动。

3、查询你输入的网址的DNS请求到本地DNS服务器之后，本地DNS服务器会首先查询它的缓存记录，如果缓存中有此条记录，就可以直接返回结果。此过程是递归的方式进行查询。如果没有，本地DNS服务器还要向DNS根服务器进行查询。

4、根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址，这种过程是迭代过程。

5、本地DNS服务器继续向域服务器发出请求，在这个例子中，请求的对象是.com域服务器。.com域服务器收到请求之后，也不会直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址。

6、最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系保存在缓存中，以备下次别的用户查询时，可以直接返回结果，加快网络访问。

4和5其实就是
根DNS服务器 告诉你 .com这个服务器在哪（域服务器）
域服务器 告诉你 163.com这个服务器在哪 （DNS服务器）

1、什么是DNS
DNS ： Domain Name System 域名系统
因特网上作为域名和IP地址相互映射的一个分布式数据库 —— 一个存映射关系的数据库
作用：方便用户访问互联网，不用记住IP地址。
主机名 -》 IP地址 = 域名解析

2、DNS查询两种方式：递归和迭代查询
1、递归解析
当局部DNS服务器不能回答时候，一般先向域名的根域服务器查询，再由根域名服务器一级级向下查询。最后得到的查询结果返回给局部DNS服务器，再由局部DNS服务器返回给客户端。
2、迭代解析
局部DNS服务器不是自己向其他DNS服务器进行查询，而是把能解析该域名的其他DNS服务器的IP地址返回给客户端DNS程序，客户端DNS程序再继续向这些DBS服务器进行查询，直到得到查询结果为止。也就是说，迭代解析只是帮你找到相关的服务器而已，而不会帮你去查。

负载均衡：
同一个主机名配置多个IP地址（相当于备份了在多台电脑上，毕竟一个ip地址就可能是一个服务器或者程序），这样将客户端的访问引导到不同的机器上去，使得不同的客户端访问不同的服务器。

3、浏览器向web服务器发送一个HTTP请求
拿到域名对应的IP地址之后，浏览器会以一个随机端口（1024<端口<65535），向服务器的WEB程序（常用的是httpd，nginx等）80端口发起TCP的连接请求。这个连接请求到达服务器端后（这中间通过各种路由设备，局域网内除外）进入网卡，然后是进入到内核的TCP/IP协议栈（用于识别该连接的请求，解封包，一层一层的剥开），还有可能要经过Netfilter防火墙（属于内核模块）的过滤，最终到达WEB程序，最终建立TCP/IP连接。

建立了TCP连接之后，发起一个http请求。一个典型的http request header 一般需要包括请求的方法，例如GET，post等，客户端向服务器发起http请求的时候，会有一些请求消息，请求消息包含三个部分：
1、请求方法
第一行是URI协议/版本
请求头包含许多有关的客户端环境和请求正文的有用信息，例如请求头可以声明浏览器所用的语言，请求正文的长度。
3、请求正文
请求头和请求正文之间时一个空行，这个行非常重要，它表示请求头已经结束，接下来的是请求正文。请求正文中可以包含客户提交的查询字符串信息：

TCP
第一次握手：
客户端A将标志为止SYN置为1，随机产生一个值为seq=J（J的取值范围为1234567）的数据包到服务器，客户端A进入SYN_SENT状态，等待服务端B确认
第二次握手：
服务端B收到数据包后由标志位SYN=1知道客户端A请求建立连接，服务端B将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给客户端A以确认连接请求，服务端B进入SYN_RCVD状态。
第三次握手：
客户端A收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给服务端B，服务端B检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，客户端A和服务端B进入ESTABLISHED状态，完成三次握手，随后客户端A和服务端B之间可以开始传输数据来。

目的
第四版中讲“三次握手”的目的是“为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误”

TCP四次挥手
第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。
第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1，（与-SYN相同，一个FIN占用一个序号），Server进入Close_wait状态
第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。
第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。

4、为什么建立连接是三次握手，而关闭连接却是四次挥手呢？
这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发生数据了但是还能接受数据，己方也未必全部数据都发送给对方了，所以已方可以立即close，也可以发送一些数据给对方后，再发生FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。

https://zhuanlan.zhihu.com/p/133906695
